<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <#include "/pages/common/head.html"/>
    <style>
        #configTypeAddForm .table > tbody > tr > td, .table > tfoot > tr > td {
            border-top: 1px solid #ddd;
            line-height: 1.88888;
            vertical-align: middle;
        }
        .layui-input {
            width: 200px;
            height: 28px;
            border-color: rgb(185, 185, 185);
        }
        #configTypeAddForm .layui-input-block, .layui-input-inline {
            margin-left: 10px;
            float: left;
            position: relative;
        }
        #configTypeAddForm .Non-Selectable{
            background-color: #F8F8F8;
            cursor: not-allowed!important;
        }
    </style>
</head>
<body>

<div class="ibox float-e-margins">
    <div class="ibox-content" style="min-height: 800px">
        <form id="configTypeAddForm"  method="post" enctype="multipart/form-data" class="layui-form" lay-filter="form">
            <div class="container-fluid">
                <div class="layui-form-item" style="padding-bottom: 50px;">
                    <div class="layui-inline">
                        <label class="layui-form-label" style="width: auto;">新增节点类型</label>
                        <div class="layui-input-inline">
                            <input type="radio" name="addType" checked lay-filter="addTypeFilter" value="1" title="新增子节点" >
                        </div>
                        <div class="layui-input-inline">
                            <input type="radio" name="addType" lay-filter="addTypeFilter" value="0" title="新增父节点">
                        </div>
                    </div>
                </div>
                <table class="table  table-condensed table-bordered text-center" style="margin: 0px;">
                    <tbody>
                    <!--新增父节点-->
                    <tr class='test-tr tr-index-0' style="display: none">
                        <td class="active" width="20%">字典编码</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text"  id="sysCode" name="sysCode" class="layui-input">
                            </div>
                            <div class="layui-input-inline">
                                <span style="color: red">*</span>
                            </div>
                        </td>
                        <td class="active" width="20%">字典名字</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text" id="sysName" name="sysName" class="layui-input">
                            </div>
                            <div class="layui-input-inline">
                                <span style="color: red">*</span>
                            </div>
                        </td>
                    </tr>
                    <tr class='test-tr tr-index-0' style="display: none">
                        <td class="active" width="20%">排序</td>
                        <td width="30%" colspan="3">
                            <div class="layui-input-inline">
                                <input type="text" id="order0" name="order0" readonly value="0" class="Non-Selectable layui-input">
                            </div>
                        </td>
                    </tr>
                    <tr class='test-tr tr-index-0' style="display: none">
                        <td class="active" width="20%" rowspan="2">描述</td>
                        <td width="30%" colspan="3" rowspan="2">
                            <div class="layui-input-inline">
                                <textarea name="display0" id="display0" placeholder="请输入新增父节点的描述" style="width:500px;" class="layui-textarea"></textarea>
                            </div>
                        </td>
                    </tr>
                    <!--新增子节点-->
                    <tr class='test-tr tr-index-1' style="display: none">
                        <td class="active" width="20%">父节点字典编码</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text"  class="Non-Selectable"  name="pCode" id="pCode">
                            </div>
                        </td>
                        <td class="active" width="20%">父节点字典名字</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input Non-Selectable" name="pName" id="pName" readonly>
                            </div>
                        </td>
                    </tr>
                    <tr class='test-tr tr-index-1' style="display: none">
                        <td class="active" width="20%">父节点ID</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input Non-Selectable" name="pId" id="pId" readonly >
                            </div>
                        </td>
                        <td class="active" width="20%">排序</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text" class="layui-input Non-Selectable" name="childOrder" id="childOrder" readonly>
                            </div>
                        </td>
                    </tr>
                    <tr class='test-tr tr-index-1' style="display: none">
                        <td class="active" width="20%">字典名字</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text" id="sysName1" name="sysName1" onchange="dictionaryCoding(this.value)" class="layui-input">
                            </div>
                            <div class="layui-input-inline">
                                <span style="color: red">*</span>
                            </div>
                        </td>
                        <td class="active" width="20%">字典编码</td>
                        <td width="30%">
                            <div class="layui-input-inline">
                                <input type="text"  id="sysCode1" name="sysCode1" class="layui-input">
                            </div>
                            <div class="layui-input-inline">
                                <span style="color: red">*</span>
                            </div>
                        </td>
                    </tr>
                    <tr class='test-tr tr-index-1' style="display: none">
                        <td class="active" width="20%" rowspan="2">描述</td>
                        <td width="30%" colspan="3" rowspan="2">
                            <div class="layui-input-inline">
                                <textarea name="display1" id="display1" placeholder="请输入新增子节点的描述" style="width:500px;" class="layui-textarea"></textarea>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </form>
    </div>
</div>
<link rel="stylesheet" type="text/css" href="/ui/easyui-1.5.1/themes/insdep/easyui.css" >
<script type="text/javascript" src="${ctx}/ui/js/jquery.min.js"></script>
<script type="text/javascript" src="/ui/easyui-1.5.1/jquery.easyui-1.5.1.min.js"></script>
<script type="text/javascript" src="/ui/easyui-1.5.1/jquery.easyui-1.5.1.min.js"></script>
<script type="text/javascript" src="${ctx}/ui/js/plugins/layui/layui.js"></script>
<script>
    $(document).ready(function(){
        $('.test-tr').hide();
        $('.tr-index-1').show();
    });
    var form;
    var checkFlag=1;
    layui.use(['form', 'layedit', 'laydate'], function(){
        form = layui.form,layer = layui.layer;
        form.render();
        form.on('radio(addTypeFilter)', function(data){
            $('.test-tr').hide();
            $('.tr-index-' + data.value).show();
            checkFlag=data.value;
        });
    });

$('#pCode').combogrid({
    loadMsg: '加载中，请稍等···',
    panelWidth: 500,
    panelHeight:180,
    delay: 500,
    mode: 'remote',
    /* 需修改为当前模块的url */
    url:'${ctx}/sys/configType/queryPno',
    idField: 'sysCode',
    textField: 'sysCode',
    method: 'POST',
    striped : true,
    rownumbers : true,
    pagination : true,
    pageList : [10,50,100],
    columns: [[
        {field:'sysCode',title:'父节点字典编码',width:150,sortable:true},
        {field:'sysName',title:'父节点字典名字',width:150,sortable:true},
        {field:'id',title:'父节点ID',width:150,sortable:true}
    ]],
    onSelect: function(index, row){
        $('#pName').val(row.sysName);
        $('#pId').val(row.id);
        $('#empNo').val(row.EMP_NO);
        $("#sysCode1").val("");
        $("#sysName1").val("");
        getOrder(row.sysCode);
    }
});

function getOrder(obj) {
    $.ajax({
        url : '${ctx}/sys/configType/queryOrder',
        type : 'post',
        dataType : 'json',
        data : {"sysCode":obj},
        cache : false,
        success : function(res) {
            if(res.code==200){
                $("#childOrder").val(res.data);
            }
        }
    });
}

function dictionaryCoding(val) {
    var pCode = $("#pCode").val();
    $.ajax({
        url : '${ctx}/sys/configType/dictionaryCoding',
        type : 'post',
        dataType : 'json',
        data : {"sysName":val,"pCode":pCode},
        cache : false,
        success : function(res) {
            if(res.code==200){
                $("#sysCode1").val(res.data);
            }else{
                $("#sysName1").val("");
                layer.tips(res.msg,'#sysName1', {
                    tips: 2
                });
            }
        }
    });
}
    /**
     * 父页面调用子页面的验证
     * @returns {boolean}
     */
    function validateAddConfigType() {
        var flag=true;
    if(checkFlag==1){
        var sysName1 = $("#sysName1").val();
        if(sysName1==''){
            validateAddTips("字典名字","，不能为空！");
            flag=false;
            return flag;
        }
        var sysCode1 = $("#sysCode1").val();
        if(sysCode1==''){
            validateAddTips("字典编码","，不能为空！");
            flag=false;
            return flag;
        }
    }else{
        var sysCode= $("#sysCode").val();
        if(sysCode==''){
            validateAddTips("字典编码","，不能为空！");
            flag=false;
            return flag;
        }
        var sysName = $("#sysName").val();
        if(sysName==''){
            validateAddTips("字典名字","，不能为空！");
            flag=false;
            return flag;
        }
    }
      return flag;
    }

    function validateAddTips(filedName,msg){
        layer.msg("<font style='color: paleturquoise'>"+filedName+"</font>"+msg+"",{
            anim:6,
        });
    }
</script>
</body>
</html>