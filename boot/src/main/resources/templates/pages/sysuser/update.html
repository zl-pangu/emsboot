<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="renderer" content="webkit" />
<!-- 让部分国产浏览器默认采用高速模式渲染页面 -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>长虹智慧社区[运维管理后台]</title>
<!-- 全局CSS 开始-->
<link href="../ui/css/global/bootstrap.min.css" rel="stylesheet">
<link href="../ui/css/global/font-awesome.min.css" rel="stylesheet" />
<link href="../ui/css/global/simple-line-icons.css" rel="stylesheet" />
<link href="../ui/css/global/animate.css" rel="stylesheet">
<link href="../ui/css/global/style.css" rel="stylesheet">
<link href="../ui/js/plugins/pace/pace.css" rel="stylesheet">

<!-- bsgrid 弹出框css -->
<link rel="stylesheet" href="../ui/artDialog/skins/blue.css"/>
<link rel="stylesheet" href="../ui/artDialog/override/artDialog.skins.override.css"/>

<!-- 全局CSS 结束-->
<!-- 页面CSS 开始-->
<link href="../ui/css/plugins/validform/style.css" rel="stylesheet">
<!-- 页面CSS 结束-->
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="../ui/js/bootstrap/html5shiv.min.js"></script>
<script src="../ui/js/bootstrap/respond.min.js"></script>
<![endif]-->
<style type="text/css">
textarea {
	resize: none;
}
</style>
</head>
<body>
<div class="ibox">
	<div class="ibox-title">
		<h5>
			<i class="fa fa-sliders"></i>修改运营
		</h5>
	</div>
	<div class="ibox-content form">
		<form id="org_form" class="form-horizontal">
			<div class="form-body">
				<div id="org_div" class="form-group">
					<label for="orgName" class="col-xs-3 text-right control-label">机构名称</label>
					<div class="col-xs-5">
						<input type="text" id="orgName" name="orgName" value="${baseOrg.orgName}" maxlength="15"
							class="form-control input-sm input-inline input-medium"
							datatype="s" nullmsg="请输入机构名称！" errormsg="请输入正确的名称！"/>
					</div>
					<div class="Validform_checktip">请输入机构名称</div>
				</div>
				<div id="city_div" class="form-group" style="display: none;">
					<label for="cityName" class="col-xs-3 text-right control-label">城市名称</label>
					<div class="col-xs-5">
						<input type="text" readonly="readonly" id="cityName" name="cityName" value="${baseOrg.orgName}" maxlength="15"
							class="form-control input-sm input-inline input-medium" />
					</div>
				</div>
				
				<!-- <div id="city_div" class="form-group" style="display: none;">
					<label for="orgName" class="col-xs-3 text-right control-label">城市名称</label>
					<div class="demo">
						<div>
							<input type="text" id="homecity_name" name="homecity_name1" value="${baseOrg.orgName}"
								style="margin-left: 14px;" size="15" 
								class="form-control input-sm input-inline input-medium"
								onkeyup="value=value.replace(/[^\u4E00-\u9FA5^a-z^A-Z^0-9]/g,'') "
								onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\u4E00-\u9FA5^a-z^A-Z^0-9]/g,''))"
								mod="address|notice" mod_address_source="hotel"
								mod_address_reference="cityid" mod_notice_tip="请输入所在城市" />
								<input id="cityid" name="cityid" type="hidden" value="{$cityid}" />
						</div>
						<div id="jsContainer" class="jsContainer" style="height: 0">
							<div id="tuna_alert" style="display: none; position: absolute; z-index: 999; overflow: hidden;"></div>
							<div id="tuna_jmpinfo" style="visibility: hidden; position: absolute; z-index: 120;"></div>
						</div>
					</div>
				</div> -->
				
				<div class="form-group">
					<label for="orgCode" class="col-xs-3 text-right control-label">上级机构</label>
					<div class="col-xs-5">
						<input type="text" value="${parentBaseOrg.orgName}" readonly="readonly" 
							class="form-control input-sm input-inline input-medium" />
					</div>
				</div>
				<div class="form-group">
					<label for="orgType" class="col-xs-3 text-right control-label">类型</label>
					<div class="col-xs-5">
						<input type="text" value="${baseOrg.orgTypeName}" readonly="readonly" 
							class="form-control input-sm input-inline input-medium" />
					</div>
				</div>
				<div class="form-group">
					<label for="orgAddress" class="col-xs-3 text-right control-label">机构地址</label>
					<div class="col-xs-5">
						<input type="text" id="orgAddress" name="orgAddress" 
							class="form-control input-sm input-inline input-medium"
							maxlength="50" value="${baseOrg.orgAddress}"/>
					</div>
				</div>
				<div class="form-group">
					<label for="orgContacts" class="col-xs-3 text-right control-label">联系人</label>
					<div class="col-xs-5">
						<input type="text" id="orgContacts" name="orgContacts" value="${baseOrg.orgContacts}"
							class="form-control input-sm input-inline input-medium"
							maxlength="18"/>
					</div>
					<div class="Validform_checktip"></div>
				</div>
				<div class="form-group">
					<label for="orgPhone" class="col-xs-3 text-right control-label">联系电话</label>
					<div class="col-xs-5">
						<input type="text" id="orgPhone" name="orgPhone" value="${baseOrg.orgPhone}"
							class="form-control input-sm input-inline input-medium" onkeyup="lengCheck()"/>
					</div>
					<div class="Validform_checktip"></div>
				</div>
				<div class="form-group">
					<label for="orgDesc" class="col-xs-3 text-right control-label">备注</label>
					<div class="col-xs-5">
						<textarea id="orgDesc" name="orgDesc" rows="3" cols="20" maxlength="128"
							class="form-control input-sm input-inline input-medium">${baseOrg.orgDesc}</textarea>
					</div>
				</div>
				
			</div>
			<div class="form-actions text-center">
				<div class="row">
					<div class="col-md-offset-3 col-md-9">
						<button id="saveBtn" type="submit" class="btn btn-sm btn-primary">提 交</button>
						<button id="cancelBtn" type="button" class="btn btn-sm btn-default">取 消</button>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
<!-- 全局js 开始-->
<script src="../ui/js/jquery.min.js"></script>
<script src="../ui/js/bootstrap/bootstrap.min.js"></script>
<script src="../ui/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../ui/js/custom/custom.js"></script>
<script src="../ui/js/plugins/pace/pace.min.js"></script>
<!-- 全局js 结束-->
<!-- 页面js 开始-->
<script src="../ui/js/plugins/validform/Validform_v5.3.2_min.js"></script>
<!-- 城市提示 -->
<!-- <script src="../ui/js/city/fixdiv.js"></script>
<script src="../ui/js/city/address.js"></script> -->

<!-- bsgrid弹出框js导入 -->
<%include('/common/artDialogJs.html'){}%>

<!-- 页面js 结束-->
<script type="text/javascript">
var validCityName = true;
$(function() {
	var org_div_html = $("#org_div").html();
	if(${baseOrg.orgType} == 4){//城市节点
		$("#city_div").show();
		$("#org_div").html("");
	}
	var submitHtml = $('#saveBtn').html();
	var org_form = $('#org_form').Validform({
		tiptype:function(msg,o,cssctl){
			if(!o.obj.is("form")){
				var objtip=o.obj.parent().siblings(".Validform_checktip");
				cssctl(objtip,o.type);
				objtip.text(msg);
			}
		},
		callback:function(form){
			//准备提交参数
			var parameter = new Object();
			parameter.id = ${baseOrg.id};
			
			if(${baseOrg.orgType} == 4){
				// 如果修改城市节点
				parameter.orgName = $("#cityName").val();
			}else{
				// 非城市节点
				parameter.orgName = $("#orgName").val();
			}
			if(!validPhone()){
				return false;
			}
			submitToggle(1);			
			parameter.orgCode = $("#orgCode").val();
			parameter.orgAddress = $("#orgAddress").val();
			parameter.orgPhone = $("#orgPhone").val();
			parameter.orgContacts = $("#orgContacts").val();
			parameter.orgDesc = $("#orgDesc").val();
			parameter.orgType = ${baseOrg.orgType};
			parameter.orgParentId = ${orgParentId};
			$.ajax({
	            type: "POST",
	            url: "/base-web/org/update",
	            data: parameter,
	            dataType: "json",
	            success: function(data){
	            	$.alert(data.info, function(){
	            		submitToggle(0);
		            	if (data.status == 1) {
		            		parent.treeRefresh(${orgParentId});
		            		forList();
		            	}
	            	}, null, null);
				},
				error:function(data) {
					submitToggle(0);
				}
	        });
			return false;
		}
	});
	
	/** 设置提交提示信息 */
	function submitToggle(status) {
		if (status == 0) {
			$('#saveBtn').html(submitHtml).attr('disabled', false);
		} else {
			$('#saveBtn').html('<i class="fa fa-spin fa-spinner"></i>    正在提交').attr('disabled', true);
		}
	}
	
	$('#cancelBtn').click(function() {
		forList();
	});
	
	function forList(){
		var type = ${parentBaseOrg.orgType};
		var url = "/base-web/org/list?orgSubtypes=${orgSubtypes}&parentId=${orgParentId}&type="+type;
		parent.setIframeUrl(url);
	}
});

/* 验证联系电话 **/
function validPhone(){
	var orgPhone = $("#orgPhone").val();
	if(orgPhone != null && orgPhone != ""){
		var reg = new RegExp("^[0-9]{8,12}$");  
		if(!reg.test(orgPhone)){  
			alert("请输入正确的联系电话!");
			return false;
		}
	}
	return true;
}

/* 验证座机号码 **/
function lengCheck(){
	var phone =$("#orgPhone").val();
	
	if(phone.length > 1){
		if(phone.substring(0,1)==0){
			$("#orgPhone").attr("maxlength","12");
		}else{
			$("#orgPhone").attr("maxlength","11");
		}
	}
}

$(function () {
	$("input").each(function () {
		$(this).keypress(function (e) {
			var key = window.event ? e.keyCode : e.which;
			if (key.toString() == "13") {
				return false;
			}
		});
	});
});

/* 验证所选择的城市是否符合要求 **/
/* function validCity(){
	var parameter = new Object();
	parameter.cityName = $("#homecity_name").val();
	$.ajax({
        type: "POST",
        url: "/base-web/com/validCity",
        data: parameter,
        dataType: "json",
        success: function(data){
        	if("y" == data.status){
        		validCityName = true;
        	}else{
        		validCityName = false;
        	}
		},
		error:function(data) {
			validCityName = false;
		}
    });
} */


</script>
</body>
</html>
