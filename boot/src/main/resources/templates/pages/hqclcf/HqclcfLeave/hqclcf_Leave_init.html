<@compress single_line=true>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="renderer" content="webkit"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <#include "/pages/common/head.html" >
    <title>离职淘汰管理</title>
</head>
<style>
    #addshowForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #addshowForm .layui-form-label {
        width: 120px !important;
    }

    #addshowForm .layui-form-item {
        margin-bottom: 0px;
    }

    #showEditForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #showEditForm .layui-form-label {
        width: 120px !important;
    }

    #showEditForm .layui-form-item {
        margin-bottom: 0px;
    }

    #showEditForm .layui-input:hover {
        border-color: #ff706f !important;
    }

    #addshowForm .layui-input:hover {
        border-color: #5bb730 !important;
    }

    #addshowAppForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #addshowAppForm .layui-form-label {
        width: 120px !important;
    }

    #addshowAppForm .layui-form-item {
        margin-bottom: 0px;
    }

    #addshowAppForm .layui-input:hover {
        border-color: #ff706f !important;
    }

    #addshowAppForm .layui-input:hover {
        border-color: #5bb730 !important;
    }

    #addshowDetForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #addshowDetForm .layui-form-label {
        width: 120px !important;
    }

    #addshowDetForm .layui-form-item {
        margin-bottom: 0px;
    }

    #addshowDetForm .layui-input:hover {
        border-color: #ff706f !important;
    }
</style>
<body>
<div class="wrapper wrapper-content animated fadeInUp">
    <ol class="breadcrumb">
        您的位置：
        <li>
            <a href="/index.html"><i class="layui-icon" style="font-weight: bold;font-size:15px;">&#xe68e;</i>主页</a>
        </li>
        <li class="active">系统管理</li>
        <li class="active">
            <i class="layui-icon" style="font-weight: bold;font-size: 15px;">&#xe715;</i>
            <font>离职淘汰管理</font>
            <link rel="stylesheet" type="text/css" href="/ui/easyui-1.5.1/themes/insdep/easyui.css">
        </li>
    </ol>
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form id="form" class="layui-form" lay-filter="form">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>员工编号：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <input name="empNo" id="empNo" type="text" class="form-control input-sm" placeholder="员工编号">
                                </div>
                            </div>
                        </div>
                        <!--员工姓名-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>员工姓名：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <input name="empName" id="empName" type="text" class="form-control input-sm" placeholder="员工姓名">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
							<div class="row">
								<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
									<label>部门：</label>
								</div>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<input id="deptName" name="deptName" value="" class="layui-input" placeholder="请选择部门" readonly onclick="showTree()"/>
                                   			<input type="hidden" id="deptNo" name="deptNo" value="">
										</div>
									</div>
								</div>
							</div>
						</div>
                        <!--是否展示下级部门-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
							  	<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
									<label>显示下级部门：</label>
								</div>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<select name="showChild" id="showChild" lay-search="">
												<option value="" selected>否</option>
												<option value="1">是</option>
											</select>
										</div>
									</div>
								</div>
                            </div>
                        </div>
                        <!--业务条线-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>业务条线：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="businessLine" id="businessLine">
                                                <option></option>
                                                <#list businessLineList as bl>
                                                <option value="${bl.sysValue!}">${bl.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--工资年月-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>工资年月：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-inline">
                                            <input type="text" class="layui-input" id="gzYm" name="gzYm"
                                                   placeholder="yyyy-MM">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--批准结果-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>批准结果:</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="appStatus" id="appStatus" lay-search="">
                                                <option></option>
                                                <#list appStatusList as bl>
                                                <option value="${bl.sysValue!}">${bl.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--状态-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>状态：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="status" id="status" lay-search="">
                                                <option></option>
                                                <#list statusList as bl>
                                                <option value="${bl.sysValue!}">${bl.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
							<div class="row">
								<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
									<label>离职日期：</label>
								</div>
								<div class="layui-input-inline" style="width: 100px;">
						       		<input type="text" class="layui-input" id="exitTimeMin" name="exitTimeMin" placeholder="yyyy-MM-dd">
						        </div>
						        <div class="layui-input-inline">至</div>
						        <div class="layui-input-inline" style="width: 100px;">
						        	<input type="text" class="layui-input" id="exitTimeMax" name="exitTimeMax" placeholder="yyyy-MM-dd">
						        </div>
							</div>
						</div>
					
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>离职/淘汰原因：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="leavingReason"  id="leavingReason"  lay-search="">
                                                <option></option>
                                                <#list dimissionTypeList as le>
                                                <option value="${le.sysValue!}">${le.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--按钮-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 col-lg-offset-6 col-md-offset-4 col-sm-offset-0 col-xs-offset-0">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable"></div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                   <@auth url='/hqclcf/hqclcfLeave/list'>
                                    <button lay-submit lay-filter="auditQuery" class="btn btn-primary btn-sm"
                                            type="button" title="查询">
                                        <i class="fa fa-search"></i>
                                        <font>查询</font>
                                    </button>
                                     </@auth>
                                     <@auth url='/hqclcf/hqclcfLeave/addInit'>
                                <button lay-submit lay-filter="add" id="addLeaveBtn" class="btn btn-primary btn-sm" type="button"
                                        title="新增" >
                                    <i class="fa fa-search"></i>
                                    <font>新增</font>
                                </button>
                                </@auth>
                                <@auth url='/hqclcf/hqclcfLeave/exportExl'>
                            <button lay-submit lay-filter="exportExl" class="btn btn-primary btn-sm"
                                    type="button" title="导出">
                                <i class="fa fa-search"></i>
                                <font>导出</font>
                            </button>
                            </@auth>
                        <button lay-submit lay-filter="reset" id="clearBtn" class="btn btn-primary btn-sm"
                                type="button" title="重置"  onclick="resetFormData()">
                            <i class="fa fa-search"></i>
                            <font>重置</font>
                        </button>

                    </div>
                </div>
        </div>

    </div>
</div>
</form>
</div>
<!--Grid-->
<div class="ibox-content">
    <table class="layui-hide" id="hqclcfLeaveTable" lay-filter="hqclcfLeaveTableFilter"></table>
</div>
<!-- 部门列表  -->
		<div id="deptNoContent" style="width:265px;height:350px; border-radius:5px;display: none; z-index:9999;position: absolute; border: 1px #CCC solid; background-color:#f9f9f9;">
			<ul id="deptNoTree" class="ztree" style="margin-top:0;height:100%;width:100%;overflow: auto;"></ul>
		</div>
</div>
</div>
</body>
<link rel="stylesheet" href="${ctx}/ui/css/plugins/zTree_v3/metroStyle/metroStyle.css" type="text/css">
<#include "/pages/common/foot.html" >
<script type="text/html" id="tableRowNumTpl">
    {{ d.LAY_TABLE_INDEX+1}}
</script>

<script type="text/html" id="businessLineListTpl">
    {{#  layui.each(${businessLineListTpl!}.obj, function(index, item){  }}
    {{#  if(item.sysValue == d.businessLine){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="dimissionTypeListTpl">
    {{#  layui.each(${dimissionTypeListTpl!}.obj, function(index, item){  }}
    {{#  if(item.sysValue == d.leavingReason){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="appStatusListTpl">
    {{#  layui.each(${appStatusListTpl!}.obj, function(index, item){  }}
    {{#  if(item.sysValue == d.appStatus){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="statusListTpl">
    {{#  layui.each(${statusListTpl!}.obj, function(index, item){  }}
    {{#  if(item.sysValue == d.status){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="empSubjectListTpl">
    {{#  layui.each(${empSubjectListTpl!}.obj, function(index, item){  }}
    {{#  if(item.sysValue == d.empSubject){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="deptListTpl">
        {{#  layui.each(${deptListTpl!}.obj, function(index, item){  }}
        {{#  if(item.deptCode == d.deptNo){  }}
        {{   item.deptName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="workplacesetListTpl">
        {{#  layui.each(${workplacesetListTpl!}.obj, function(index, item){  }}
        {{#  if(item.areaCode == d.workOrgNo){  }}
        {{   item.area }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="postListTpl">
        {{#  layui.each(${postListTpl!}.obj, function(index, item){  }}
        {{#  if(item.postNo == d.post){  }}
        {{   item.postName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="bussinListTpl">
        {{#  layui.each(${bussinListTpl!}.obj, function(index, item){  }}
        {{#  if(item.posCode == d.position){  }}
        {{   item.posName}}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="rankListTpl">
        {{#  layui.each(${rankListTpl!}.obj, function(index, item){  }}
        {{#  if(item.no == d.rank){  }}
        {{   item.name }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
<script type="text/html" id="tableRowOperationTpl">
    {{#  if(d.status == '1'){ }}
<@auth url='/hqclcf/hqclcfLeave/editInit'>
    <a class="layui-btn layui-btn-radius layui-btn-xs" lay-event="edit">修改</a>
</@auth>
    {{#  } }}
    {{#  if(d.status == '1'){ }}
<@auth url='/hqclcf/hqclcfLeave/del'>
    <a class="layui-btn layui-btn-radius layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</@auth>   
 {{#  } }}
    {{#  if(d.status == '1'){ }}
<@auth url='/hqclcf/hqclcfLeave/appInit'>
    <a class="layui-btn layui-btn-radius layui-btn-xs" lay-event="approve">审批</a>
</@auth>
    {{#  } }}
<@auth url='/hqclcf/hqclcfLeave/detail'>
    <a class="layui-btn layui-btn-radius layui-btn-danger layui-btn-xs" lay-event="details">详细信息</a>
</@auth>
</script>
<script type="text/javascript">
    var table;
    var form;
    layui.use(['table', 'form', 'laydate'], function () {
        table = layui.table;
        form = layui.form;
        laydate = layui.laydate;
        form.render();
        laydate.render({
            elem: '#gzYm',
            type: 'month'
        });
        laydate.render({
            elem: '#exitTimeMin'
        });
        laydate.render({
            elem: '#exitTimeMax'
        });
        laydate.render({
            elem: '#exitTime',
        });
        laydate.render({
            elem: '#exitTimeEdit'
        });
        table.render({
            elem: $('#hqclcfLeaveTable'),
            id: 'id',
            url: '${ctx}/hqclcf/hqclcfLeave/list',
            loading: true,
            method: 'post',
            cols: [[
                {width: 70, fixed: true, title: '序号', align: 'center', templet: '#tableRowNumTpl'},
                {field: 'empNo', title: '员工编号', width: 150, align: 'center'},
                {field: 'empName', title: '员工姓名', width: 100, align: 'center'},
                {field: 'empSubject', title: '主体', width: 90, align: 'center', templet: '#empSubjectListTpl'},
                {field:'deptPname',title: '部门',width:200,align:'center'},
                  /* {field: 'deptName', title: '部门名称', width: 180, align: 'center'},*/
                {field: 'businessLine', title: '业务条线', width: 100, align: 'center', templet: '#businessLineListTpl'},
                 {field: 'post', title: '岗位', width: 80, align: 'center', templet: '#postListTpl' },
                 {field: 'position', title: '职务', width: 80, align: 'center'  , templet: '#bussinListTpl' },
                 {field: 'rank', title: '职级', width: 100, align: 'center' , templet: '#rankListTpl'},    
                 /*{field: 'postName', title: '岗位', width: 120, align: 'center'},
                {field: 'positionName', title: '职务', width: 120, align: 'center'},
                {field: 'rankName', title: '职级', width: 100, align: 'center'},*/
                {field: 'entryTime', title: '入职时间', width: 150, align: 'center'},
                {field: 'exitTime', title: '离职/淘汰日期', width: 150, align: 'center'},
                {field: 'gzYm', title: '工资年月', width: 100, align: 'center'},
                {field: 'leavingReason',title: '离职/淘汰原因',width: 200,align: 'center',templet: '#dimissionTypeListTpl'},
                {field: 'appStatus', title: '批准结果', width: 150, align: 'center', templet: '#appStatusListTpl'},
                {field: 'status', title: '状态', width: 100, align: 'center', templet: '#statusListTpl'},
                {fixed: 'right', title: '操作', width: 250, align: 'center', toolbar: '#tableRowOperationTpl'}
            ]],
            height: '500',
            skin: 'row',
            size: 'sm',
            even: true,
            page: true,
            limits: [10, 30, 50],
            limit: 10,
        });
        
        
        /*表单事件*/
        form.on('submit(auditQuery)', function (obj) {
            table.reload('id', {
                where: obj.field || {}
            })
        });
        
        /*导出离职淘汰信息*/
        form.on('submit(exportExl)', function () {
            window.location = '${ctx}/hqclcf/hqclcfLeave/exportExl?' + $("#form").serialize();
            return false;
        });

        
         $("#addLeaveBtn").bind('click',function () {
            window.location.href="${ctx}/hqclcf/hqclcfLeave/addInit";
        });
        
        
         table.on('tool(hqclcfLeaveTableFilter)', function (obj) {
             var data = obj.data;
             if (obj.event === 'del') {
             layer.confirm('真的要删除这一行吗？', function (index) {
                 $.ajax({
                     url: "${ctx}/hqclcf/hqclcfLeave/del",
                     type: "POST",
                     data: {"data": JSON.stringify(data)},
                     dataType: "json",
                     success: function (data) {
                         if (data.success) {
                             layer.msg("删除失败:" + data.msg, {icon: 5});
                         } else {
                             obj.del();
                             layer.close(index);
                             layer.msg("删除成功", {icon: 6});
                             table.reload('id', {
                                 where: obj.field || {}
                             })
                         }
                     }
                 });
                 table.reload('id', {
                     url: '${ctx}/hqclcf/hqclcfLeave/list'
                 });
             })
             }else if (obj.event === 'edit') {
            	 window.location.href="${ctx}/hqclcf/hqclcfLeave/editInit?id="+ obj.data.priNumber ;    
             }else if (obj.event === 'approve') {
            	 window.location.href="${ctx}/hqclcf/hqclcfLeave/appInit?id="+ obj.data.priNumber ;    
             }else if (obj.event === 'details') {
            	 window.location.href="${ctx}/hqclcf/hqclcfLeave/detail?id="+ obj.data.priNumber ;
             }
         });
    });
   
    
    
   

    function delById(obj) {
        var data = obj.data;
        layer.confirm('真的要删除这一行吗？', function (index) {
            $.ajax({
                url: "${ctx}/hqclcf/hqclcfLeave/del",
                type: "POST",
                data: {"data": JSON.stringify(data)},
                dataType: "json",
                success: function (data) {
                    if (data.success) {
                        layer.msg("删除失败:" + data.msg, {icon: 5});
                    } else {
                        obj.del();
                        layer.close(index);
                        layer.msg("删除成功", {icon: 6});
                    }
                }
            });
            table.reload('id', {
                url: '${ctx}/hqclcf/hqclcfLeave/list'
            });
        })
    }
    
    var treeObj;
	var setting = {
		async : {
			dataFilter : function(id, pNode, res) {
				if (res.code == 200) {
					if (res && res.data)
						return res.data;
				} else {
					layer.alert("加载树失败：" + res.msg, {
						icon : 5,
						title : "失败"
					});
					return [];
				}
			},
			enable : true,
			url : "${ctx}/hqclcf/hqclcfdept/buildTreeByUserbL",
			autoParam : [ "id" ],
			otherParam : {}
		},
		view : {
			dblClickExpand : false,
			showLine : true
		},
		data : {
			simpleData : {
				enable : true,
				idKey : "id",
				pIdKey : "pid"
			}
		},
		callback : {
			onAsyncSuccess : function(event, treeId, treeNode, msg) {
				var zTree = $.fn.zTree.getZTreeObj("deptNoTree");
				var node = zTree.getNodeByParam("id", $("#deptNo").val(), null);
				zTree.selectNode(node);
				treeObj.expandAll(true);
			},
			onClick : function(event, treeId, treeNode) {
				$("#deptNo").val(treeNode.id);
				$("#deptName").val(treeNode.name);
			}

		}
	};

	function showTree() {
		treeObj = $.fn.zTree.init($("#deptNoTree"), setting);
		var deptOffset = $("#deptName").offset();
		$("#deptNoContent").css({
			left : deptOffset.left + "px",
			top : deptOffset.top + 28 + "px"
		}).slideDown("fast");
		
		$("body").bind("mousedown", function onBodyDown(event) {
			var length = $(event.target).parents("#deptNoTree").length;
			var id = event.target.id;
			if (!(length == 1 || (length == 0 && id == 'deptNoTree'))) {
				$("#deptNoContent").fadeOut("fast");
				$("body").unbind("mousedown", onBodyDown);
			}
		});
	}
	
	function resetFormData() {
        $("#form")[0].reset();
    }
	
	$("#clearBtn").bind('click',function () {
        $("#deptName").val("");
        $("#deptNo").val("");
        $("#empName").val("");
        $("#empNo").val("");
        $("#businessLine").val("");
        $("#showChild").val("");
        $("#gzYm").val("");
        $("#appStatus").val("");
        $("#status").val("");
                 
        form.render();
      });
    

</script>
</html>
</@compress>
