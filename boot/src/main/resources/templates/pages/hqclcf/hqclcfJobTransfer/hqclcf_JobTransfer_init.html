<@compress single_line=true>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="renderer" content="webkit"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <#include "/pages/common/head.html" >
    <title>离职转在职</title>
</head>
<style>
    #addshowForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #addshowForm .layui-form-label {
        width: 120px !important;
    }

    #addshowForm .layui-form-item {
        margin-bottom: 0px;
    }

    #addshowForm .layui-input:hover {
        border-color: #5bb730 !important;
    }

    #editshowForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #editshowForm .layui-form-label {
        width: 120px !important;
    }

    #editshowForm .layui-form-item {
        margin-bottom: 0px;
    }

    #editshowForm .layui-input:hover {
        border-color: #5bb730 !important;
    }

    #edtshowForm .layui-inline {
        width: 320px;
        margin-left: 10px;
        display: inline;
    }

    #edtshowForm .layui-form-label {
        width: 120px !important;
    }

    #edtshowForm .layui-form-item {
        margin-bottom: 0px;
    }

    #edtshowForm .layui-input:hover {
        border-color: #5bb730 !important;
    }
</style>
<body>
<div class="wrapper wrapper-content animated fadeInUp">
    <ol class="breadcrumb">
        您的位置：
        <li>
            <a href="/index.html"><i class="layui-icon" style="font-weight: bold;font-size:15px;">&#xe68e;</i>主页</a>
        </li>
        <li class="active">系统管理</li>
        <li class="active">
            <i class="layui-icon" style="font-weight: bold;font-size: 15px;">&#xe715;</i>
            <font>离职转在职</font>
        </li>
    </ol>
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form id="form" class="layui-form" lay-filter="form">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>员工编号：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <input name="empNo" type="text" class="form-control input-sm" placeholder="员工编号">
                                </div>
                            </div>
                        </div>
                        <!--员工姓名-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>员工姓名：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <input name="empName" type="text" class="form-control input-sm" placeholder="员工姓名">
                                </div>
                            </div>
                        </div>
                        <!--部门-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>部门：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<input id="deptName" name="deptName" value="" class="layui-input" placeholder="请选择部门" readonly onclick="showTree('dept')"/>
                                   			<input type="hidden" id="deptNo" name="deptNo" value="">
										</div>
									</div>
								</div>
                            </div>
                        </div>
                        <!--是否展示下级部门-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
							  	<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
									<label>显示下级部门：</label>
								</div>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<select name="qx" lay-search="">
												<option value="" selected>否</option>
												<option value="1">是</option>
											</select>
										</div>
									</div>
								</div>
                            </div>
                        </div>
                        <!--工资年月-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>工资年月：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-inline">
                                            <input type="text" class="layui-input" id="gzYm" name="gzYm"
                                                   placeholder="yyyy-MM">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--原业务条线-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>原业务条线：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="oldBusinessLine" lay-search="">
                                                <option></option>
                                                <#list businessLineList as bl>
                                                <option value="${bl.sysValue!}">${bl.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--原部门-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>原部门：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<input id="oldDeptName" name="oldDeptName" value="" class="layui-input" placeholder="请选择原部门"  onclick="showTree('oldDept')"/>
                                   			<input type="hidden" id="oldDeptNo" name="oldDeptNo" value="">
										</div>
									</div>
								</div>
                            </div>
                        </div>
                         <!--是否展示下级部门-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
							  	<div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
									<label>显示下级部门：</label>
								</div>
								<div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
									<div class="layui-form-item">
										<div class="layui-input-block">
											<select name="oldqx" lay-search="">
												<option value="" selected>否</option>
												<option value="1">是</option>
											</select>
										</div>
									</div>
								</div>
                            </div>
                        </div>
                        <!--主体-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>员工主体：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="empSubject">
                                                <option></option>
                                                <option value="1">ZH</option>
                                                <option value="2">HT</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--业务条线-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable">
                                    <label>业务条线：</label>
                                </div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <select name="businessLine" lay-search="">
                                                <option></option>
                                                <#list businessLineList as bl>
                                                <option value="${bl.sysValue!}">${bl.sysName!}</option>
                                            </#list>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--按钮-->
                        <div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 col-lg-offset-6 col-md-offset-4 col-sm-offset-0 col-xs-offset-0">
                            <div class="row">
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 zh-form-lable"></div>
                                <div class="col-lg-8 col-md-8 col-sm-8 col-xs-8 zh-form-content">
                                    <@auth url='/hqclcf/hqclcfJobTransfer/list'>
                                    <button lay-submit lay-filter="auditQuery" class="btn btn-primary btn-sm"
                                            type="button" title="查询">
                                        <i class="fa fa-search"></i>
                                        <font>查询</font>
                                    </button>
                                </@auth>
                                <@auth url='/hqclcf/hqclcfJobTransfer/addInit'>
                                <button lay-submit lay-filter="openDeduct" class="btn btn-primary btn-sm" type="button" id="openAddDeduct"
                                        title="新增" onclick="">
                                    <i class="fa fa-search"></i>
                                    <font>新增</font>
                                </button>
                            </@auth>
                            <button lay-submit lay-filter="reset" class="btn btn-primary btn-sm" type="button"
                                    title="重置" onclick="restFormData()">
                                <i class="fa fa-search"></i>
                                <font>重置</font>
                            </button>
                        </div>
                    </div>
                </div>

        </div>
    </div>
    </form>
</div>
<!--Grid-->
<div class="ibox-content">
    <table class="layui-hide" id="hqclcfJobTransferTable" lay-filter="hqclcfJobTransferTableFilter"></table>
</div>
<!-- 现部门列表  -->
		<div id="deptNoContent" style="width:265px;height:350px; border-radius:5px;display: none; z-index:9999;position: absolute; border: 1px #CCC solid; background-color:#f9f9f9;">
			<ul id="deptNoTree" class="ztree" style="margin-top:0;height:100%;width:100%;overflow: auto;"></ul>
		</div>
<!-- 原部门列表  -->
		<div id="oldDeptNoContent" style="width:265px;height:350px; border-radius:5px;display: none; z-index:9999;position: absolute; border: 1px #CCC solid; background-color:#f9f9f9;">
			<ul id="oldDeptNoTree" class="ztree" style="margin-top:0;height:100%;width:100%;overflow: auto;"></ul>
		</div>		
		
</div>
</div>     
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<link rel="stylesheet" href="${ctx}/ui/css/plugins/zTree_v3/metroStyle/metroStyle.css" type="text/css">
<#include "/pages/common/foot.html" >
<script type="text/html" id="tableRowNumTpl">
    {{ d.LAY_TABLE_INDEX+1}}
</script>
<script type="text/html" id="businessLineListTpl1">
    {{#  layui.each(${businessLineListTpl!}.obj, function(index, item){}}
    {{#  if(item.sysValue == d.oldBusinessLine){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>

<script type="text/html" id="businessLineListTpl2">
    {{#  layui.each(${businessLineListTpl!}.obj, function(index, item){}}
    {{#  if(item.sysValue == d.businessLine){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="deptListTpl">
        {{#  layui.each(${deptListTpl!}.obj, function(index, item){  }}
        {{#  if(item.deptCode == d.deptNo){  }}
        {{   item.deptName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="deptListTpl1">
        {{#  layui.each(${deptListTpl!}.obj, function(index, item){  }}
        {{#  if(item.deptCode == d.oldDeptNo){  }}
        {{   item.deptName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="postListTpl">
        {{#  layui.each(${postListTpl!}.obj, function(index, item){  }}
        {{#  if(item.postNo == d.post){  }}
        {{   item.postName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="postListTpl1">
        {{#  layui.each(${postListTpl!}.obj, function(index, item){  }}
        {{#  if(item.postNo == d.oldPost){  }}
        {{   item.postName }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="bussinListTpl">
        {{#  layui.each(${bussinListTpl!}.obj, function(index, item){  }}
        {{#  if(item.posCode == d.oldPosition){  }}
        {{   item.posName}}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="bussinListTpl2">
        {{#  layui.each(${bussinListTpl!}.obj, function(index, item){  }}
        {{#  if(item.posCode == d.position){  }}
        {{   item.posName}}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="rankListTpl">
        {{#  layui.each(${rankListTpl!}.obj, function(index, item){  }}
        {{#  if(item.no == d.oldRank){  }}
        {{   item.name }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
    <script type="text/html" id="rankListTpl1">
        {{#  layui.each(${rankListTpl!}.obj, function(index, item){  }}
        {{#  if(item.no == d.rank){  }}
        {{   item.name }}
        {{#  return true;  }}
        {{#  } }}
        {{#  });}}
    </script>
<script type="text/html" id="empSubjectListTpl">
    {{#  layui.each(${empSubjectListTpl!}.obj, function(index, item){}}
    {{#  if(item.sysValue == d.empSubject){  }}
    {{   item.sysName }}
    {{#  return true;  }}
    {{#  } }}
    {{#  });}}
</script>
<script type="text/html" id="tableRowOperationTpl">
<@auth url='/hqclcf/hqclcfJobTransfer/editInit'>
    <a class="layui-btn layui-btn-radius layui-btn-xs" lay-event="edit">修改</a>
</@auth>
<@auth url='/hqclcf/hqclcfJobTransfer/detailInit'>
    <a class="layui-btn layui-btn-radius layui-btn-danger layui-btn-xs" lay-event="det">详细信息</a>
</@auth>
</script>
<script type="text/javascript">
    var table;
    var form;
    layui.use(['table', 'form', 'laydate'], function () {
        table = layui.table;
        form = layui.form;
        laydate = layui.laydate;
        form.render();
        laydate.render({
            elem: '#enterDate'
        });
        laydate.render({
            elem: '#enterDateEdit'
        });
        laydate.render({
            elem: '#gzYm',
            type: 'month'
        });
        table.render({
            elem: '#hqclcfJobTransferTable',
            id: 'id',
            url: '${ctx}/hqclcf/hqclcfJobTransfer/list',
            loading: true,
            method: 'post',
            cols: [[
                {width: 70, fixed: true, title: '序号', align: 'center', templet: '#tableRowNumTpl'},
                {field: 'empNo', title: '员工编号', width: 150, align: 'center'},
                {field: 'empName', title: '员工姓名', width: 100, align: 'center'},
                {field: 'empSubject', title: '主体', width: 90, align: 'center', templet: '#empSubjectListTpl'},
                {field: 'oldDeptPname', title: '原部门', width: 180, align: 'center'},
                /* {field: 'oldDeptNo', title: '原部门', width: 180, align: 'center',templet: '#deptListTpl1'}, */
                /*{field: 'oldDeptName', title: '原部门', width: 180, align: 'center'},*/
                {
                    field: 'oldBusinessLine',
                    title: '原业务条线',
                    width: 100,
                    align: 'center',
                    templet: '#businessLineListTpl1'
                },
                {field: 'oldPost', title: '原岗位', width: 80, align: 'center', templet: '#postListTpl1'},
                {field: 'oldPosition', title: '原职务', width: 80, align: 'center', templet: '#bussinListTpl'},
                {field: 'oldRank', title: '原职级', width: 100, align: 'center', templet: '#rankListTpl'},
                {field: 'deptPname', title: '现部门', width: 180, align: 'center'},
                /* {field: 'deptNo', title: '现部门', width: 180, align: 'center',templet: '#deptListTpl'}, */
                {field: 'businessLine', title: '现业务条线', width: 100, align: 'center', templet: '#businessLineListTpl2'},
                {field: 'post', title: '现岗位', width: 80, align: 'center', templet: '#postListTpl'},
                {field: 'position', title: '现职务', width: 80, align: 'center', templet: '#bussinListTpl2'},
                {field: 'rank', title: '现职级', width: 100, align: 'center',templet: '#rankListTpl1'},
                /* {field: 'rankName', title: '现职级', width: 100, align: 'center'}, */
                {field: 'leaveDate', title: '离职日期', width: 150, align: 'center'},
                {field: 'oldEntryTime', title: '原入职时间', width: 150, align: 'center'},
                {field: 'enterDate', title: '现入职时间', width: 150, align: 'center'},
                {field: 'gzYm', title: '工资年月', width: 100, align: 'center'},
                {fixed: 'right', title: '操作', width: 250, align: 'center', toolbar: '#tableRowOperationTpl'}
            ]],
            height: '500',
            skin: 'row',
            size: 'sm',
            even: true,
            page: true,
            limits: [10, 30, 50],
            limit: 10
        });
        form.on('submit(auditQuery)', function (data) {
            console.log(JSON.stringify(data));
            table.reload('id', {
                where: data.field || {}
            })
        });
        table.on('tool(hqclcfJobTransferTableFilter)', function (obj) {
            var event = obj.event;
            if (event === 'edit') {
            	window.location.href="${ctx}/hqclcf/hqclcfJobTransfer/editInit?id="+ obj.data.priNumber ;    
            } else if (event === 'det') {
            	window.location.href="${ctx}/hqclcf/hqclcfJobTransfer/detailInit?id="+ obj.data.priNumber ; 
            }
        });
    });
    
    var setting = {
		async : {
			dataFilter : function(id, pNode, res) {
				if (res.code == 200) {
					if (res && res.data)
						return res.data;
				} else {
					layer.alert("加载树失败：" + res.msg, {
						icon : 5,
						title : "失败"
					});
					return [];
				}
			},
			enable : true,
			url : "${ctx}/hqclcf/hqclcfdept/buildTreeByUserbL",
			autoParam : [ "id" ],
			otherParam : {}
		},
		view : {
			dblClickExpand : false,
			showLine : true
		},
		data : {
			simpleData : {
				enable : true,
				idKey : "id",
				pIdKey : "pid"
			}
		},
		callback : {
			onAsyncSuccess : function(event, treeId, treeNode, msg) {
				var zTree = $.fn.zTree.getZTreeObj("deptNoTree");
				var node = zTree.getNodeByParam("id", $("#deptNo").val(), null);
				zTree.selectNode(node);
				treeObj.expandAll(true);
			},
			onClick : function(event, treeId, treeNode) {
				$("#deptNo").val(treeNode.id);
				$("#deptName").val(treeNode.name);
			}
		}
	};

    var oldSetting = {
		async : {
			dataFilter : function(id, pNode, res) {
				if (res.code == 200) {
					if (res && res.data)
						return res.data;
				} else {
					layer.alert("加载树失败：" + res.msg, {
						icon : 5,
						title : "失败"
					});
					return [];
				}
			},
			enable : true,
			url : "${ctx}/hqclcf/hqclcfdept/buildTreeByUserbL",
			autoParam : [ "id" ],
			otherParam : {}
		},
		view : {
			dblClickExpand : false,
			showLine : true
		},
		data : {
			simpleData : {
				enable : true,
				idKey : "id",
				pIdKey : "pid"
			}
		},
		callback : {
			onAsyncSuccess : function(event, treeId, treeNode, msg) {
				var zTree = $.fn.zTree.getZTreeObj("oldDeptNoTree");
				var node = zTree.getNodeByParam("id", $("#oldDeptNo").val(), null);
				zTree.selectNode(node);
				treeObj.expandAll(true);
			},
			onClick : function(event, treeId, treeNode) {
				$("#oldDeptNo").val(treeNode.id);
				$("#oldDeptName").val(treeNode.name);
			}

		}
	};
    
	function showTree(para) {
	    if(para == "dept"){
		treeObj = $.fn.zTree.init($("#"+para+"NoTree"), setting);
		var deptOffset = $("#"+para+"Name").offset();
		$("#"+para+"NoContent").css({
			left : deptOffset.left + "px",
			top : deptOffset.top + 28 + "px"
		}).slideDown("fast");
		
		$("body").bind("mousedown", function onBodyDown(event) {
			var length = $(event.target).parents("#"+para+"NoTree").length;
			var id = event.target.id;
			if (!(length == 1 || (length == 0 && id == para+'NoTree'))) {
				$("#"+para+"NoContent").fadeOut("fast");
				$("body").unbind("mousedown", onBodyDown);
			}
		});
	  }else{
	     treeObj = $.fn.zTree.init($("#"+para+"NoTree"), oldSetting);
		var deptOffset = $("#"+para+"Name").offset();
		$("#"+para+"NoContent").css({
			left : deptOffset.left + "px",
			top : deptOffset.top + 28 + "px"
		}).slideDown("fast");
		
		$("body").bind("mousedown", function onBodyDown(event) {
			var length = $(event.target).parents("#"+para+"NoTree").length;
			var id = event.target.id;
			if (!(length == 1 || (length == 0 && id == para+'NoTree'))) {
				$("#"+para+"NoContent").fadeOut("fast");
				$("body").unbind("mousedown", onBodyDown);
			}
		});
	  }
		
	}
	
	function restFormData(){
		document.getElementById("form").reset();
		$("#deptNo").val("");
		$("#oldDeptNo").val("");
	}
	
	   $("#openAddDeduct").bind('click',function () {
            window.location.href="${ctx}/hqclcf/hqclcfJobTransfer/addInit";
        });
</script>
</html>
</@compress>