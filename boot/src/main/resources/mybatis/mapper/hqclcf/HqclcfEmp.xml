<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhph.mapper.hqclcf.HqclcfEmpMapper">
    <resultMap id="hqclcfEmpMap" type="com.zhph.model.hqclcf.HqclcfEmp">
        <id column="ID" property="id" jdbcType="BIGINT"/>
        <result column="EMP_NO" property="empNo" jdbcType="VARCHAR"/>
        <result column="EMP_NAME" property="empName" jdbcType="VARCHAR"/>
        <result column="SEX" property="sex" jdbcType="VARCHAR"/>
        <result column="NATION" property="nation" jdbcType="VARCHAR"/>
        <result column="MARRIAGE" property="marriage" jdbcType="VARCHAR"/>
        <result column="ID_TYPE" property="idType" jdbcType="VARCHAR"/>
        <result column="ID_CARD" property="idCard" jdbcType="VARCHAR"/>
        <result column="IDCARD_NAME" property="idcardName" jdbcType="VARCHAR"/>
        <result column="NATIVE_TYPE" property="nativeType" jdbcType="VARCHAR"/>
        <result column="NATIVE_PLACE" property="nativePlace" jdbcType="VARCHAR"/>
        <result column="ADDR" property="addr" jdbcType="VARCHAR"/>
        <result column="MOBILE_PHONE" property="mobilePhone" jdbcType="VARCHAR"/>
        <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
        <result column="URGENCY" property="urgency" jdbcType="VARCHAR"/>
        <result column="URGENCY_PHONE" property="urgencyPhone" jdbcType="VARCHAR"/>
        <result column="URGENCY_RELATION" property="urgencyRelation" jdbcType="VARCHAR"/>
        <result column="EDU" property="edu" jdbcType="VARCHAR"/>
        <result column="SCHOOL_GRADUATION" property="schoolGraduation" jdbcType="VARCHAR"/>
        <result column="EDU_TYPE" property="eduType" jdbcType="VARCHAR"/>
        <result column="SPECIALTY" property="specialty" jdbcType="VARCHAR"/>
        <result column="EMP_SUBJECT" property="empSubject" jdbcType="VARCHAR"/>
        <result column="ENTER_DATE" property="enterDate" jdbcType="TIMESTAMP"/>
        <result column="LX_ENTER_DATE" property="lxEnterDate" jdbcType="TIMESTAMP"/>
        <result column="FULL_TIME_BEGIN_DATE" property="fulltimeBeginDate" jdbcType="TIMESTAMP"/>
        <result column="FULL_TIME_END_DATE" property="fulltimeEndDate" jdbcType="TIMESTAMP"/>
        <result column="EMP_TYPE" property="empType" jdbcType="VARCHAR"/>
        <result column="BUSINESS_LINE" property="businessLine" jdbcType="VARCHAR"/>
        <result column="QX" property="qx" jdbcType="VARCHAR"/>
        <result column="DEPT_NO" property="deptNo" jdbcType="VARCHAR"/>
        <result column="POST" property="post" jdbcType="VARCHAR"/>
        <result column="POSITION" property="position" jdbcType="VARCHAR"/>
        <result column="RANK" property="rank" jdbcType="VARCHAR"/>
        <result column="COMPANY_MAILBOX" property="companyMailbox" jdbcType="VARCHAR"/>
        <result column="WORK_ORG_NO" property="workOrgNo" jdbcType="VARCHAR"/>
        <result column="PF_BANK_CODE" property="pfBankCode" jdbcType="VARCHAR"/>
        <result column="PFBANKNO" property="pfBankNo" jdbcType="VARCHAR"/>
        <result column="OPEN_BANK_ORG" property="openBankOrg" jdbcType="VARCHAR"/>
        <result column="PF_BANK_SUBBRANCH" property="pfBankSubbranch" jdbcType="VARCHAR"/>
        <result column="TFDATE" property="tfDate" jdbcType="TIMESTAMP"/>
        <result column="LEAVE_DATE" property="leaveDate" jdbcType="TIMESTAMP"/>
        <result column="TAX_CODE" property="taxCode" jdbcType="VARCHAR"/>
        <result column="SOCIAL_SECURITYO_RGNO" property="socialSecurityOrgNo" jdbcType="VARCHAR"/>
        <result column="WAGES_NO" property="wagesNo" jdbcType="VARCHAR"/>
        <result column="WAGES_NUM" property="wagesNum" jdbcType="VARCHAR"/>
        <result column="REFEREES_NO" property="refereesNo" jdbcType="VARCHAR"/>
        <result column="REFEREES" property="referees" jdbcType="VARCHAR"/>
        <result column="CITY_LEVEL" property="cityLevel" jdbcType="VARCHAR"/>
        <result column="COMMENTS" property="comments" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" jdbcType="VARCHAR"/>
        <result column="STATUS_APP" property="statusApp" jdbcType="VARCHAR"/>
        <result column="RESULTS_APP" property="resultsApp" jdbcType="VARCHAR"/>
        <result column="REASONS_APP" property="reasonsApp" jdbcType="VARCHAR"/>
        <result column="BAD_CREDIT" property="badCredit" jdbcType="VARCHAR"/>
        <result column="ZH_WORK_EXP" property="ZHWorkExp" jdbcType="VARCHAR"/>
        <result column="CREATOR" property="creator" jdbcType="VARCHAR"/>
        <result column="CREATE_TIME" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="UPDATOR" property="updator" jdbcType="VARCHAR"/>
        <result column="UPDATE_TIME" property="updatetime" jdbcType="TIMESTAMP"/>
        <result column="APPROVER" property="approver" jdbcType="VARCHAR"/>
        <result column="APPROVER_TIME" property="approverTime" jdbcType="TIMESTAMP"/>

        <result column="ENTER_DATE" property="enterDateMin" jdbcType="TIMESTAMP"/>
        <result column="ENTER_DATE" property="enterDateMax" jdbcType="TIMESTAMP"/>

        <result column="HJ_PROVINCE" property="hjProvince" jdbcType="VARCHAR"/>
        <result column="HJ_CITY" property="hjCity" jdbcType="VARCHAR"/>
        <result column="HJ_AREA" property="hjArea" jdbcType="VARCHAR"/>
        <result column="HJ_XJDZ" property="hjxjdz" jdbcType="VARCHAR"/>

        <result column="XJ_PROVINCE" property="xjProvince" jdbcType="VARCHAR"/>
        <result column="XJ_CITY" property="xjCity" jdbcType="VARCHAR"/>
        <result column="XJ_AREA" property="xjArea" jdbcType="VARCHAR"/>
        <result column="XJ_XXDZ" property="xjxxdz" jdbcType="VARCHAR"/>

        <result column="BANK_PROVINCE" property="bankProvince" jdbcType="VARCHAR"/>
        <result column="BANK_CITY" property="bankCity" jdbcType="VARCHAR"/>
        <result column="BANK_XXDJ" property="bankxxdj" jdbcType="VARCHAR"/>

        <result column="DEPT_NAME" property="deptName" jdbcType="VARCHAR"/>
        <result column="DEPT_PNAME" property="deptPname" jdbcType="VARCHAR"/>
        <result column="POST_NAME" property="postName" jdbcType="VARCHAR"/>
        <result column="POS_NAME" property="posName" jdbcType="VARCHAR"/>
        <result column="RANK_NAME" property="rankName" jdbcType="VARCHAR"/>

		<result column="WORKORGNO_NAME" property="workOrgNo_name" jdbcType="VARCHAR" />
		<result column="BANK_NAME" property="pfBankCode_name" jdbcType="VARCHAR" />
		
		<result column="P_NAME" property="p_name" jdbcType="VARCHAR" />
		<result column="CD_NAME" property="cd_name" jdbcType="VARCHAR" />
		
    </resultMap>


    <select id="queryAllEmp" parameterType="com.zhph.model.hqclcf.HqclcfEmp" resultMap="hqclcfEmpMap">
        select HE.*,(select HDD.DEPT_NAME from HQCLCF_DEPT HDD WHERE HDD.ID = HD.PID)||'--'||HD.DEPT_NAME AS DEPT_PNAME
        from HQCLCF_EMP HE left join HQCLCF_DEPT HD ON HE.Dept_No = HD.DEPT_CODE
        <where>
            AND HE.STATUS_APP='1'
            <if test="empNo!=null and empNo!='' ">
                AND he.EMP_NO like '%'||#{empNo}||'%'
            </if>
            <if test="empName!=null and empName!='' ">
                AND he.EMP_NAME like '%'||#{empName}||'%'
            </if>
            <if test="deptNo!=null and deptNo!='' and qx==''">
                AND he.DEPT_NO=#{deptNo}
            </if>
            <if test="businessLine!=null and businessLine!='' ">
                AND he.BUSINESS_LINE=#{businessLine}
            </if>
            <if test="workOrgNo!=null and workOrgNo!='' ">
                AND he.WORK_ORG_NO=#{workOrgNo}
            </if>
            <if test="status!=null and status!='' ">
                AND he.STATUS=#{status}
            </if>
            <if test="empType!=null and empType!='' ">
                AND he.EMP_TYPE=#{empType}
            </if>
            <if test="enterDateMin!=null ">
                <![CDATA[ AND he.ENTER_DATE >=#{enterDateMin} ]]>
            </if>
            <if test="enterDateMax!=null">
                <![CDATA[ AND he.ENTER_DATE <=#{enterDateMax} ]]>
            </if>
            <if test="userId!=null and userId!=''">
                AND EXISTS (
                	SELECT A.dept_code FROM HQCLCF_DEPT A INNER JOIN SYS_USER_DEPTAUTH_REF B ON A.ID = B.DEPT_ID
                		WHERE A.dept_code = HE.DEPT_NO AND B.user_id = #{userId} GROUP BY A .dept_code
                )
            </if>
            <if test="qx!='' and deptHid!=null">
                AND he.DEPT_NO IN(SELECT DEPT_CODE FROM HQCLCF_DEPT START WITH ID = #{deptHid} CONNECT BY PID = PRIOR ID)
            </if>
        </where>
    </select>

    <update id="updateById" parameterType="com.zhph.model.hqclcf.HqclcfEmp">
        UPDATE HQCLCF_EMP W
        SET
        w.EMP_NAME=#{empName,jdbcType=VARCHAR},
        w.IDCARD_NAME=#{idcardName,jdbcType=VARCHAR},
        w.SEX=#{sex,jdbcType=VARCHAR},
        w.MARRIAGE=#{marriage,jdbcType=VARCHAR},
        w.NATIVE_TYPE=#{nativeType,jdbcType=VARCHAR},
        w.ID_TYPE=#{idType,jdbcType=VARCHAR},
        w.ID_CARD=#{idCard,jdbcType=VARCHAR},
        w.NATION=#{nation,jdbcType=VARCHAR},
        w.HJ_PROVINCE=#{hjProvince,jdbcType=VARCHAR},
        w.HJ_CITY=#{hjCity,jdbcType=VARCHAR},
        w.HJ_AREA=#{hjArea,jdbcType=VARCHAR},
        w.HJ_XJDZ=#{hjxjdz,jdbcType=VARCHAR},
        w.NATIVE_PLACE=#{nativePlace,jdbcType=VARCHAR},
        w.XJ_PROVINCE=#{xjProvince,jdbcType=VARCHAR},
        w.XJ_CITY=#{xjCity,jdbcType=VARCHAR},
        w.XJ_AREA=#{xjArea,jdbcType=VARCHAR},
        w.XJ_XXDZ=#{xjxxdz,jdbcType=VARCHAR},
        w.ADDR=#{addr,jdbcType=VARCHAR},
        w.MOBILE_PHONE=#{mobilePhone,jdbcType=VARCHAR},
        w.URGENCY=#{urgency,jdbcType=VARCHAR},
        w.URGENCY_PHONE=#{urgencyPhone,jdbcType=VARCHAR},
        w.URGENCY_RELATION=#{urgencyRelation,jdbcType=VARCHAR},
        w.EMAIL=#{email,jdbcType=VARCHAR},
        w.COMPANY_MAILBOX=#{companyMailbox,jdbcType=VARCHAR},
        w.SCHOOL_GRADUATION=#{schoolGraduation,jdbcType=VARCHAR},
        w.EDU=#{edu,jdbcType=VARCHAR},
        w.EDU_TYPE=#{eduType,jdbcType=VARCHAR},
        w.SPECIALTY=#{specialty,jdbcType=VARCHAR},
        w.ENTER_DATE=#{enterDate,jdbcType=TIMESTAMP},
        w.TFDATE=#{tfDate,jdbcType=TIMESTAMP},
        w.EMP_SUBJECT=#{empSubject,jdbcType=VARCHAR},
        w.LX_ENTER_DATE=#{lxEnterDate,jdbcType=TIMESTAMP},
        w.FULL_TIME_BEGIN_DATE=#{fulltimeBeginDate,jdbcType=TIMESTAMP},
        w.FULL_TIME_END_DATE=#{fulltimeEndDate,jdbcType=TIMESTAMP},
        w.DEPT_NO=#{deptNo,jdbcType=VARCHAR},
        w.POST=#{post,jdbcType=VARCHAR},
        w.POSITION=#{position,jdbcType=VARCHAR},
        w.RANK=#{rank,jdbcType=VARCHAR},
        w.BUSINESS_LINE=#{businessLine,jdbcType=VARCHAR},
        w.WORK_ORG_NO=#{workOrgNo,jdbcType=VARCHAR},
        w.CITY_LEVEL=#{cityLevel,jdbcType=VARCHAR},
        w.EMP_TYPE=#{empType,jdbcType=VARCHAR},
        w.PF_BANK_CODE=#{pfBankCode,jdbcType=VARCHAR},
        w.PFBANKNO=#{pfBankNo,jdbcType=VARCHAR},
        w.BANK_PROVINCE=#{bankProvince,jdbcType=VARCHAR},
        w.BANK_CITY=#{bankCity,jdbcType=VARCHAR},
        w.BANK_XXDJ=#{bankxxdj,jdbcType=VARCHAR},
        w.OPEN_BANK_ORG=#{openBankOrg,jdbcType=VARCHAR},
        w.TAX_CODE=#{taxCode,jdbcType=VARCHAR},
        w.WAGES_NO=#{wagesNo,jdbcType=VARCHAR},
        w.WAGES_NUM=#{wagesNum,jdbcType=VARCHAR},
        w.REFEREES=#{referees,jdbcType=VARCHAR},
        w.REFEREES_NO=#{refereesNo,jdbcType=VARCHAR},
        w.COMMENTS=#{comments,jdbcType=VARCHAR},
        w.UPDATOR=#{updator,jdbcType=VARCHAR},
        w.UPDATE_TIME=#{updatetime,jdbcType=TIMESTAMP}
        <where>
            AND w.ID=#{id,jdbcType=BIGINT}
        </where>
    </update>

    <update id="updateEmpById" parameterType="com.zhph.model.hqclcf.HqclcfLeave">
        UPDATE HQCLCF_EMP W
        SET w.LEAVE_DATE=#{exitTime,jdbcType=TIMESTAMP},
        w.COMMENTS=#{remark,jdbcType=VARCHAR},
        w.STATUS=#{status,jdbcType=INTEGER},
        w.UPDATE_TIME=#{updateDate,jdbcType=TIMESTAMP},
        w.UPDATOR=#{approverName,jdbcType=VARCHAR}
        <where>
            AND w.EMP_NO=#{empNo,jdbcType=VARCHAR}
        </where>
    </update>

    <update id="updateJobById" parameterType="com.zhph.model.hqclcf.HqclcfJobTransfer">
        UPDATE HQCLCF_EMP W
        SET
        w.DEPT_NO=#{deptNo,jdbcType=VARCHAR},
        w.BUSINESS_LINE=#{businessLine,jdbcType=VARCHAR},
        w.POSITION=#{position,jdbcType=VARCHAR},
        w.RANK=#{rank,jdbcType=VARCHAR},
        w.POST=#{post,jdbcType=VARCHAR},
        w.EMP_SUBJECT=#{empSubject,jdbcType=VARCHAR},
        w.ENTER_DATE=#{enterDate,jdbcType=TIMESTAMP},
        w.LEAVE_DATE=#{leaveDate,jdbcType=TIMESTAMP},
        w.COMMENTS=#{comments,jdbcType=VARCHAR},
        w.UPDATE_TIME=#{updateDate,jdbcType=TIMESTAMP},
        w.UPDATOR=#{updateName,jdbcType=VARCHAR},
        w.STATUS=#{status,jdbcType=INTEGER}
        WHERE w.EMP_NO=#{empNo,jdbcType=VARCHAR}
    </update>

    <update id="updateEmpStatusByParams" parameterType="com.zhph.model.hqclcf.HqclcfEmp">
        UPDATE hqclcf_emp W
        SET
        w.status=#{status,jdbcType=INTEGER}
        <where>
            AND w.emp_no=#{empNo,jdbcType=VARCHAR}
        </where>
    </update>

    <select id="queryEmpByEmpNo" parameterType="java.lang.String" resultMap="hqclcfEmpMap">
		select HE.*,HD.DEPT_NAME,HP.POST_NAME,HB.POS_NAME,HR.NAME AS RANK_NAME 
			from HQCLCF_EMP HE 
				left join HQCLCF_DEPT HD ON HE.Dept_No = HD.DEPT_CODE
				left join HQCLCF_POST HP ON HE.Post = HP.POST_NO
				left join HQCLCF_BUSINESS_SCHEDULED HB ON HE.Position = HB.POS_CODE
				left join HQCLCF_RANK_SCHEDULED HR ON HR.NO = HE.RANK
			where HE.EMP_NO = #{value} AND HE.STATUS_APP='1'
	</select>

    <select id="leaveEmpByEmpNameOrNo" parameterType="java.lang.String" resultType="java.util.HashMap">
        SELECT
        EMP_NO,
        EMP_NAME,
        DEPT_NO,
        DEPT_NAME,
        to_char(ENTER_DATE,'yyyy-MM-dd') AS ENTER_DATE,
        CASE WHEN EMP_SUBJECT=1
        THEN 'ZH'
        ELSE 'HT' END EMP_SUBJECT_NAME,
        EMP_SUBJECT,
        CASE WHEN BUSINESS_LINE=1
        THEN '总部'
        WHEN BUSINESS_LINE=2
        THEN '消分'
        WHEN BUSINESS_LINE=3
        THEN '信贷'
        END AS BUSINESS_LINE,
        BUSINESS_LINE AS BUSINESS_CODE,
        RANKNO,
        RANKNAME,
        POS_CODE,
        POS_NAME,
        POST_NO,
        POST_NAME
        FROM (
        SELECT *
        FROM
        (
        SELECT *
        FROM HQCLCF_EMP
        WHERE STATUS_APP = '1' AND STATUS = '1') emp LEFT JOIN (
        SELECT
        POST_NO,
        POST_NAME
        FROM HQCLCF_POST
        ) post ON emp.POST = post.POST_NO
        LEFT JOIN (SELECT
        DEPT_CODE,
        DEPT_NAME
        FROM HQCLCF_DEPT) dept ON emp.DEPT_NO = dept.DEPT_CODE
        LEFT JOIN (SELECT
        NO AS RANKNO,
        NAME AS RANKNAME
        FROM HQCLCF_RANK_SCHEDULED
        WHERE STATUS = '1') ra ON emp.RANK = ra.rankNo
        LEFT JOIN (SELECT
        POS_CODE,
        POS_NAME
        FROM HQCLCF_BUSINESS_SCHEDULED) pos ON emp.POSITION = pos.POS_CODE
        )
        WHERE
        1=1
        <if test="empNo!=null and empNo!='' ">
            AND EMP_NO=#{empNo}
        </if>
        <if test="empName!=null and empName!='' ">
            AND EMP_NAME=#{empName}
        </if>
    </select>


    <select id="jobTransferEmpByEmpNameOrNo" parameterType="java.lang.String" resultType="java.util.HashMap">
        SELECT
        EMP_NAME,
        EMP_NO,
        DEPT_NO,
        DEPT_NAME,
        to_char(ENTER_DATE,'yyyy-MM-dd') AS ENTER_DATE,
        CASE WHEN EMP_SUBJECT=1
        THEN 'ZH'
        ELSE 'HT' END EMP_SUBJECT_NAME,
        EMP_SUBJECT,
        CASE WHEN BUSINESS_LINE=1
        THEN '总部'
        WHEN BUSINESS_LINE=2
        THEN '消分'
        WHEN BUSINESS_LINE=3
        THEN '信贷'
        END AS BUSINESS_LINE,
        BUSINESS_LINE AS BUSINESS_CODE,
        rankNo,
        rankName,
        POS_CODE,
        POS_NAME,
        POST_NO,
        POST_NAME
        FROM (
        SELECT *
        FROM
        (
        SELECT *
        FROM HQCLCF_EMP
        WHERE STATUS_APP='1' AND STATUS='2') emp LEFT JOIN (
        SELECT
        POST_NO,
        POST_NAME
        FROM HQCLCF_POST
        ) post ON emp.POST = post.POST_NO
        LEFT JOIN (SELECT
        DEPT_CODE,
        DEPT_NAME
        FROM HQCLCF_DEPT) dept ON emp.DEPT_NO = dept.DEPT_CODE
        LEFT JOIN (SELECT
        NO AS rankNo,
        NAME AS rankName
        FROM HQCLCF_RANK_SCHEDULED
        WHERE STATUS = '1') ra ON emp.RANK = ra.rankNo
        LEFT JOIN (SELECT
        POS_CODE,
        POS_NAME
        FROM HQCLCF_BUSINESS_SCHEDULED) pos ON emp.POSITION = pos.POS_CODE
        )
        WHERE
        1=1
        <if test="empNo!=null and empNo!='' ">
            AND EMP_NO=#{empNo}
        </if>
        <if test="empName!=null and empName!='' ">
            AND EMP_NAME=#{empName}
        </if>
    </select>

    <select id="queryEmpNameByNo" parameterType="java.lang.String" resultMap="hqclcfEmpMap">
		select * from hqclcf_emp e
		where e.emp_no = #{empNo,jdbcType=VARCHAR}
	</select>

    <select id="empByBankCode" parameterType="java.lang.String" resultType="java.lang.Integer">
		SELECT 
		count(*) 
		FROM HQCLCF_EMP e 
		where e.PF_BANK_CODE = #{bankCode,jdbcType=VARCHAR}
	</select>
	

    <select id="queryAllWithoutStatus" parameterType="com.zhph.model.hqclcf.HqclcfEmp" resultMap="hqclcfEmpMap">
        select h.*
        from hqclcf_emp h
        <where>
            <if test="empNo!=null and empNo != '' ">
                and h.emp_no like '%${empNo}%'
            </if>
            <if test="empName!=null and empName !='' ">
                and h.emp_name like '%${empName}%'
            </if>
            <if test="deptNo !=null and deptNo !='' ">
                and h.dept_no = #{deptNo}
            </if>
            <if test="businessLine !=null and businessLine !='' ">
                and h.business_line = #{businessLine}
            </if>
            <if test="status!=null and status!='' ">
                and h.status = #{status}
            </if>
            <if test="post!=null and post!='' ">
                and h.post = #{post}
            </if>
            <if test="statusApp!=null and statusApp!='' ">
                and h.status_app = #{statusApp}
            </if>
        </where>
    </select>

    <select id="queryEmpByq" resultMap="hqclcfEmpMap">
        select e.* from hqclcf_emp e
        <where>
            and e.status_app = 1
            and e.status != 2
            <if test="searchValue != null and searchValue !='' ">
                and (e.emp_no like '%${searchValue}%'
                or e.emp_name like '%${searchValue}%')
            </if>

            <if test="isBl!=null and isBl!=''">
                and e.business_line in
                <foreach collection="loginUserId" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>

        </where>
    </select>
    <select id="queryEmpByq1" resultType="java.util.Map" parameterType="java.util.Map">
				        SELECT
				A.EMP_NO AS EMPNO,
				A.EMP_NAME AS EMPNAME,
				DE.DEPT_CODE AS DEPTNO,
				DE.DEPT_NAME AS DEPTNAME,
				A.BUSINESS_LINE AS BUSINESSLINE,
				BU.POS_CODE AS POSITION,
				BU.POS_NAME AS POSITIONNAME,
				RA.NO AS RANKNO, 
				RA.NAME AS RANKNAME,
				B.POST_NO AS POSTNO,
				B.POST_NAME AS POSTNAME,
				to_char(A.ENTER_DATE,'yyyy-MM-dd') AS ENTERDATE,
				A.EMP_SUBJECT AS EMPSUBJECT
				FROM
					HQCLCF_EMP A
				LEFT JOIN HQCLCF_POST B ON A .POST = B.POST_NO
				LEFT JOIN HQCLCF_DEPT DE ON A.DEPT_NO=DE.DEPT_CODE
				LEFT JOIN HQCLCF_BUSINESS_SCHEDULED BU ON BU.POS_CODE= A.POSITION
				LEFT JOIN HQCLCF_RANK_SCHEDULED RA ON RA.NO =A.RANK
        <where>
        A.status_app = '1' and A.status = '1'
            <if test="q != null and q !='' ">
                and A.emp_no like '%${q}%'
            </if>
            <if test="q != null and q !='' ">
                or A.emp_name like '%${q}%'
            </if>
            <if test="isBl!=null and isBl!=''">
                and A.business_line in
                <foreach collection="loginUserId" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>
    <select id="queryEmpByq2" resultType="java.util.Map">
					        SELECT
				A.EMP_NO AS EMPNO,
				A.EMP_NAME AS EMPNAME,
				DE.DEPT_CODE AS DEPTNO,
				DE.DEPT_NAME AS DEPTNAME,
				A.BUSINESS_LINE AS BUSINESSLINE,
				BU.POS_CODE AS POSITION,
				BU.POS_NAME AS POSITIONNAME,
				RA.NO AS RANKNO, 
				RA.NAME AS RANKNAME,
				B.POST_NO AS POSTNO,
				B.POST_NAME AS POSTNAME,
				to_char(A.ENTER_DATE,'yyyy-MM-dd') AS ENTERDATE,
				A.EMP_SUBJECT AS EMPSUBJECT
				FROM
					HQCLCF_EMP A
				LEFT JOIN HQCLCF_POST B ON A .POST = B.POST_NO
				LEFT JOIN HQCLCF_DEPT DE ON A.DEPT_NO=DE.DEPT_CODE
				LEFT JOIN HQCLCF_BUSINESS_SCHEDULED BU ON BU.POS_CODE= A.POSITION
				LEFT JOIN HQCLCF_RANK_SCHEDULED RA ON RA.NO =A.RANK
        <where>
             A.status_app = '1' and A.status = '2'
            <if test="searchValue != null and searchValue !='' ">
                and A.emp_no like '%${searchValue}%'
            </if>
            <if test="searchValue != null and searchValue !='' ">
                or A.emp_name like '%${searchValue}%'
            </if>
            <if test="isBl!=null and isBl!=''">
                and A.business_line in
                <foreach collection="loginUserId" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>
    
    <select id="queryDataById" parameterType="java.lang.String" resultMap="hqclcfEmpMap">
        select HE.*,(select HDD.DEPT_NAME from HQCLCF_DEPT HDD WHERE HDD.ID = HD.PID)||'--'||HD.DEPT_NAME AS DEPT_PNAME,HP.POST_NAME,HB.POS_NAME,HR.NAME AS RANK_NAME from HQCLCF_EMP HE left join HQCLCF_DEPT HD ON HE.Dept_No = HD.DEPT_CODE left join HQCLCF_POST HP ON HE.Post = HP.POST_NO left join HQCLCF_BUSINESS_SCHEDULED HB ON HE.Position = HB.POS_CODE left join HQCLCF_RANK_SCHEDULED HR ON HR.NO = HE.RANK where HE.status_app='1' and HE.id = ${id}
    </select>

    <select id="queryEmpOrganizatDept" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(*)
		from HQCLCF_EMP h
		where
		  h.DEPT_NO = #{deptNo}
		  and h.STATUS_APP = 1 and h.STATUS_APP is not null
		  and h.STATUS != 2 and h.status is not null
	</select>

    <select id="queryEmpClAchieveDetailDept" resultMap="hqclcfEmpMap" parameterType="java.lang.String">
		select *
		from HQCLCF_EMP h
		where
		  h.DEPT_NO = #{deptNo}
		  and h.STATUS_APP = 1 and h.STATUS_APP is not null
		  and h.STATUS != 2 and h.status is not null
	</select>

    <select id="queryEmpOrganizatPost" resultType="java.lang.Integer" parameterType="java.lang.String">
		select count(*)
		from HQCLCF_EMP j
		where
		  j.post = #{postNo}
		  and j.STATUS_APP = 1 and j.STATUS_APP is not null
		  and j.STATUS != 2 and j.status is not null
	</select>

    <select id="getEmpListByType" parameterType="java.lang.String" resultMap="hqclcfEmpMap">
		select HE.*,HD.DEPT_NAME,HP.POST_NAME,HB.POS_NAME,HR.NAME AS RANK_NAME from HQCLCF_EMP HE left join HQCLCF_DEPT HD ON HE.Dept_No = HD.DEPT_CODE left join HQCLCF_POST HP ON HE.Post = HP.POST_NO left join HQCLCF_BUSINESS_SCHEDULED HB ON HE.Position = HB.POS_CODE left join HQCLCF_RANK_SCHEDULED HR ON HR.NO = HE.RANK where HE.status_app='1' AND HE.EMP_SUBJECT = '1'  AND HE.Business_Line IN (2,3) AND HE.Business_Line IS NOT NULL and HE.EMP_NO NOT IN (select HC.EMPNO from HQCLCF_EMP_SUBJECT_CHANGE HC where HC.STATUS = '1')
        <if test="q!=null and q !=''">
        	AND HE.EMP_NO like  '%${q}%'
        </if>
        <if test="userId!=null and userId!=''">
                AND EXISTS (
                	SELECT A.dept_code FROM HQCLCF_DEPT A INNER JOIN SYS_USER_DEPTAUTH_REF B ON A.ID = B.DEPT_ID
                		WHERE A.dept_code = HE.DEPT_NO AND B.user_id = #{userId} GROUP BY A .dept_code
                )
            </if>
	</select>

    <update id="updateEmpSubjectByEmpNo" parameterType="Object">
		UPDATE HQCLCF_EMP W SET w.EMP_SUBJECT=#{empSubject,jdbcType=VARCHAR} where w.EMP_NO=#{empNo,jdbcType=VARCHAR}
	</update>


    <select id="queryEmpByMap" parameterType="java.util.HashMap" resultMap="hqclcfEmpMap">
        select * from hqclcf_emp e
        <where>
            <if test="q!=null and q!=''">
                and (e.EMP_NO like CONCAT(CONCAT('%', #{q}),'%') or e.EMP_NAME like CONCAT(CONCAT('%', #{q}),'%'))
            </if>
            <if test="bls!=null ">
                AND e.BUSINESS_LINE IN
                <foreach collection="bls" open="(" separator="," close=")" item="item">
                    #{item}
                </foreach>
            </if>
        </where>
    </select>
    
    <select id="queryAllEmpForExport" parameterType="com.zhph.model.hqclcf.HqclcfEmp" resultMap="hqclcfEmpMap">
		select HE.*,
           	HD.DEPT_NAME,
           	HP.POST_NAME,
           	HB.POS_NAME,
           	HR.NAME AS RANK_NAME,
           	SWS.AREA AS WORKORGNO_NAME,
           	SZB.BANK_NAME,
           	(SELECT TO_CHAR(WM_CONCAT(H.DEPT_TYPE||'='||H.DEPT_NAME)) FROM HQCLCF_DEPT H  WHERE DEPT_TYPE IS NOT NULL AND ID !=1 START WITH ID= (SELECT ID FROM HQCLCF_DEPT TEMP WHERE TEMP.DEPT_CODE=HE.DEPT_NO)  CONNECT BY PRIOR PID = ID) AS P_NAME,
           	(SELECT TO_CHAR(WM_CONCAT(H.ID||'='||H.DEPT_NAME)) FROM HQCLCF_DEPT H  WHERE  ID !=1 START WITH ID= (SELECT ID FROM HQCLCF_DEPT TEMP WHERE TEMP.DEPT_CODE=HE.DEPT_NO)  CONNECT BY PRIOR PID = ID) AS CD_NAME
          from HQCLCF_EMP HE 
          	left join HQCLCF_DEPT HD ON HE.Dept_No = HD.DEPT_CODE 
         	left join HQCLCF_POST HP ON HE.Post = HP.POST_NO 
          	left join HQCLCF_BUSINESS_SCHEDULED HB ON HE.Position = HB.POS_CODE 
         	left join HQCLCF_RANK_SCHEDULED HR ON HR.NO = HE.RANK
          	left join SYS_WORKPLACE_SET SWS ON HE.Work_Org_No = SWS.AREA_CODE
          	left join SYS_ZHPH_BANK  SZB ON HE.PF_BANK_CODE = SZB.BANK_CODE
		<where>
			AND HE.STATUS_APP='1'
			<if test="empNo!=null and empNo!='' ">
				AND he.EMP_NO like '%'||#{empNo}||'%'
			</if>
			<if test="empName!=null and empName!='' ">
				AND he.EMP_NAME like '%'||#{empName}||'%'
			</if>
			<if test="deptNo!=null and deptNo!='' ">
				AND he.DEPT_NO=#{deptNo}
			</if>
			<if test="businessLine!=null and businessLine!='' ">
				AND he.BUSINESS_LINE=#{businessLine}
			</if>
			<if test="workOrgNo!=null and workOrgNo!='' ">
				AND he.WORK_ORG_NO=#{workOrgNo}
			</if>
			<if test="status!=null and status!='' ">
				AND he.STATUS=#{status}
			</if>
			<if test="empType!=null and empType!='' ">
				AND he.EMP_TYPE=#{empType}
			</if>
			<if test="enterDateMin!=null ">
				<![CDATA[ AND he.ENTER_DATE >=#{enterDateMin} ]]>
			</if>
			<if test="enterDateMax!=null">
				<![CDATA[ AND he.ENTER_DATE <=#{enterDateMax} ]]>
			</if>
			<if test="userId!=null and userId!=''">
	             AND EXISTS (
	                SELECT A.dept_code FROM HQCLCF_DEPT A INNER JOIN SYS_USER_DEPTAUTH_REF B ON A.ID = B.DEPT_ID
						WHERE A.dept_code = HE.DEPT_NO AND B.user_id = #{userId} GROUP BY A .dept_code
	             )
	        </if>
		</where>
	</select>
    
    <select id="AutoTfEmpType" statementType="CALLABLE">  
		<![CDATA[ {call STP_AUTO_CALCULATE_EMPTYPE} ]]>   
	</select>
	
	<select id="queryForScheduling" parameterType="map" resultMap="hqclcfEmpMap">
		SELECT * FROM HQCLCF_EMP WHERE STATUS_APP=1 AND (STATUS=1 OR (STATUS=2 AND to_char(LEAVE_DATE,'yyyy-MM')=#{gzym})) 
		<if test="businessLine != null">
			AND BUSINESS_LINE=#{businessLine}
		</if>
	</select>
	<insert id="bakupHqclcfEmpForPerGzym" parameterType="string">
		INSERT INTO HQCLCF_EMP_GZYM_REF SELECT #{value},t.* FROM HQCLCF_EMP t 
	</insert>
	<delete id="deleteHqclcfEmpBakByGzym" parameterType="string">
		DELETE FROM HQCLCF_EMP_GZYM_REF WHERE GZYM=#{value}
	</delete>
	
	<select id="querySalaryEmp" resultType="java.util.Map">
				SELECT
				  he.emp_no,he.emp_name
				FROM
					 hqclcf_emp he left join 
					 HQCLCF_BUSINESS_SCHEDULED hs on hs.pos_code = he.position
              where
              he.BUSINESS_LINE = '3'
              and he.status_app = '1' 
              and he.status = '1' 
              and hs.pos_code='ZW72510'
    </select>
    
    <select id="queryTeamManagerEmp" resultType="java.util.Map">
				SELECT
				  he.emp_no,he.emp_name
				FROM
					 hqclcf_emp he left join 
					 HQCLCF_BUSINESS_SCHEDULED hs on hs.pos_code = he.position
              where
              he.BUSINESS_LINE = '3'
              and he.status_app = '1' 
              and he.status = '1' 
              and hs.pos_code='ZW7A25B'
    </select>
    
    
    <select id="queryOrgManagerEmp" resultType="java.util.Map">
				SELECT
				  he.emp_no,he.emp_name
				FROM
					 hqclcf_emp he left join 
					 HQCLCF_BUSINESS_SCHEDULED hs on hs.pos_code = he.position
              where
              he.BUSINESS_LINE = '3'
              and he.status_app = '1' 
              and he.status = '1' 
              and hs.pos_code='ZW13FED'
    </select>
    
    
    <select id="queryAreaManagerEmp" resultType="java.util.Map">
				SELECT
				  he.emp_no,he.emp_name
				FROM
					 hqclcf_emp he left join 
					 HQCLCF_BUSINESS_SCHEDULED hs on hs.pos_code = he.position
              where
              he.BUSINESS_LINE = '3'
              and he.status_app = '1' 
              and he.status = '1' 
              and hs.pos_code='ZW906E2'
    </select>
</mapper>